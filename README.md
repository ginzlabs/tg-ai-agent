# Telegram AI Agent

Telegram bot platform for conversational AI with any LLM, tool execution, report generation, task scheduling, and advanced speech-to-text with summarization. Features user access control, persistent memory via **Supabase**, and a flexible credit/quota system.
Built with **LangGraph**, **OpenRouter**, **AssemblyAI** STT, **Tavily** search, and task scheduling via **FastAPI** & **Docker**.

## üöÄ Key Features

- **AI Framework Integration**: LangGraph with OpenRouter API access to various models
- **Advanced Memory System**: Short and long-term memory with custom storage modules
- **Speech Processing**: Transcription for short messages, full summarization and document generation for longer audio
- **Asynchronous Task Management**: FastAPI-based queuing system (extensible to Celery for thousands of users)
- **Human-in-the-Loop (HITL)**: Interactive decision-making capabilities
- **User Management**: Add/remove users by instructing the bot using natural language 
- **Task Scheduling**: Regular automated task execution
- **Credits System**: Daily/monthly limits with automated reset via cron jobs
- **Market Report Generation**: Automated bond yield reports with web scraping, PDF generation, and delivery
- **Modular Architecture**: Easy to extend and customize for specific use cases

![Agent Workflow](images/Telegram%20AI%20Agent%20-%20Agent%20Workflow.png)

*AI Agent Workflow: LangGraph-based conversation and task processing flow*

## üîå External APIs & Services

- **[OpenRouter](https://openrouter.ai/)**: Multi-model AI API access
- **[Telegram Bot API](https://core.telegram.org/bots/api)**: Bot communication and webhook handling
- **[AssemblyAI](https://www.assemblyai.com/)**: Speech-to-text transcription services
- **[Supabase](https://supabase.com/)**: Database and real-time features
- **[Tavily](https://tavily.com/)**: Web search capabilities
- **[LangGraph](https://langchain-ai.github.io/langgraph/)**: AI agent framework and workflow management
- **[FastAPI](https://fastapi.tiangolo.com/)**: Modern web framework for building APIs
- **[Docker](https://www.docker.com/)**: Containerization platform

## üèóÔ∏è Architecture

The system consists of three main Docker services:
- **Bot Service** (Port 9001): Telegram bot interface and user interactions
- **Backend Service** (Port 9002): API endpoints and background processing
- **Selenium Service** (Port 4444): Web scraping capabilities

![System Design](images/Telegram%20AI%20Agent%20-%20System%20Design.png)

*System Architecture: Docker services and their interactions*

## ‚ö° Quick Start

1. **Set up Supabase locally**
   ```bash
   # Install Supabase CLI (see https://supabase.com/docs/guides/cli for installation)
   supabase start
   ```

2. **Set up [NGROK](https://ngrok.com/) tunnels**
   ```bash
   # From root directory
   ngrok start --all --config ./ngrok.yml
   ```

3. **Telegram Bot Setup**:
   - Use BotFather (@BotFather) in Telegram to create a new bot and get the token; keep these safe and insert in .env.
   - To add nice menu in Telegram, run `/setcommands` in BotFather with the following commands:
     ```
     list_abilities - üßæ List abilities  
     change_model - ü§ñ Change LLM  
     clear_dialog - üóëÔ∏è Clear conversation  
     clear_memory - üß† Clear memory  
     check_limits - üìä Check usage limits
     ```

4. **Configure environment variables**
   ```bash
   cp .env.example .env
   # Copy NGROK URLs from step 2 and bot token from step 3
   # Add your other API keys and configuration
   ```

5. **Register webhook**
   ```
   Register webhook by opening this URL in your browser (replace values with your actual data):
   https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/setWebhook?url={YOUR_WEBHOOK_URL}&secret_token={YOUR_SECRET_TOKEN}
   ```

6. **Start the services**
   ```bash
   docker-compose -f docker-compose.yml -f docker-compose.override.yml up --build
   ```

7. **Create admin user**
   ```bash
   # Windows CMD (substitute with actual values)
   curl -X POST "http://localhost:9001/create_user" -H "X-Secret-Token: YOUR_SECRET_TOKEN" -H "Content-Type: application/json" -d "{\"user_name\":\"your_telegram_username\", \"role\":\"admin\", \"tier\":\"3\"}"
   ```
   The service requires users to have a username. If successful, you'll see the admin user added to the chats table in Supabase and the Telegram ID will be filled in on first interaction.

## üìñ Exploring the Codebase

This project is designed to be AI-assisted friendly. The best way to understand the implementation:

1. **Fork to your favorite IDE** (VS Code, Cursor, etc.)
2. **Use AI assistance** to explore the modular structure
3. **Check API documentation** - Visit the FastAPI autogenerated docs to explore and extend APIs:
   - Bot API: `http://localhost:9001/docs`
   - Backend API: `http://localhost:9002/docs`
4. **Customize AI models** - You can use any OpenRouter models that support tool calling by updating the `ALLOWED_LLM_MODELS` parameter in your `.env` file

## üì± Platform Compatibility

- **Developed on**: Windows
- **Runs on**: Any platform with Docker support
- **Minimal changes required** for Linux/macOS/VPS deployment

## üöÄ Production Deployment

The service can be easily deployed on VPS and we recommend **[Coolify](https://coolify.io/)** for deployment with **[Supabase Cloud](https://supabase.com/)** for the database.

## üìÑ License & Disclaimer

This code is provided under the **MIT License** without any guarantees or warranties and is provided only for **educational purposes**.
